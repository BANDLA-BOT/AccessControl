"use strict";var express=require("express"),bcrypt=require("bcryptjs"),jwt=require("jsonwebtoken"),User=require("../models/User"),router=express.Router();router.post("/register",function(r,t){var s,n,a,u,o,i,p;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.body,n=s.username,a=s.email,u=s.password,o=s.role,e.next=3,regeneratorRuntime.awrap(User.findOne({email:a}));case 3:if(i=e.sent)return e.abrupt("return",t.status(400).send("User already exists."));e.next=6;break;case 6:return i=new User({username:n,email:a,password:u,role:o}),e.next=9,regeneratorRuntime.awrap(bcrypt.genSalt(10));case 9:return p=e.sent,e.next=12,regeneratorRuntime.awrap(bcrypt.hash(u,p));case 12:return i.password=e.sent,e.next=15,regeneratorRuntime.awrap(i.save());case 15:t.send(i);case 16:case"end":return e.stop()}})}),router.post("/login",function(r,t){var s,n,a,u,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.body,n=s.email,a=s.password,e.next=3,regeneratorRuntime.awrap(User.findOne({email:n}));case 3:if(u=e.sent){e.next=6;break}return e.abrupt("return",t.status(400).send("Invalid email or password."));case 6:return e.next=8,regeneratorRuntime.awrap(bcrypt.compare(a,u.password));case 8:if(e.sent){e.next=11;break}return e.abrupt("return",t.status(400).send("Invalid email or password."));case 11:o=jwt.sign({_id:u._id,role:u.role},"jwt_secret"),t.send(o);case 13:case"end":return e.stop()}})}),module.exports=router;
//# sourceMappingURL=auth.min.js.map
